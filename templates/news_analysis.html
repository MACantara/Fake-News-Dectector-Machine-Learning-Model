{% extends "base.html" %}

{% block title %}News Analysis - Advanced News Analyzer{% endblock %}

{% block content %}
<!-- Model Status Display -->
<div id="modelStatus" class="glass-effect rounded-xl p-4 mb-8 text-center status-loading">
    <div class="flex items-center justify-center">
        <i class="bi bi-hourglass-split spin text-blue-600 mr-2"></i>
        <span class="text-gray-700">Loading models...</span>
    </div>
</div>

<!-- Input Type Selector -->
<div class="mb-8">
    <h2 class="text-2xl font-semibold text-gray-800 mb-4">
        <i class="bi bi-input-cursor"></i>
        Choose Input Method
    </h2>
    <div class="flex flex-wrap gap-4">
        <button id="textBtn" class="input-type-btn bg-blue-600 text-white px-6 py-3 rounded-lg font-medium focus-ring">
            <i class="bi bi-textarea-t mr-2"></i>
            Text Input
        </button>
        <button id="urlBtn" class="input-type-btn bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-medium focus-ring">
            <i class="bi bi-link-45deg mr-2"></i>
            Article URL
        </button>
        <button id="websiteBtn" class="input-type-btn bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-medium focus-ring">
            <i class="bi bi-globe2 mr-2"></i>
            News Website
        </button>
    </div>
</div>

<!-- Analysis Type Selector -->
<div id="analysisTypeSection" class="mb-8">
    <h2 class="text-2xl font-semibold text-gray-800 mb-4">
        <i class="bi bi-gear"></i>
        Choose Analysis Type
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <button id="fakeNewsBtn" class="analysis-type-btn bg-red-600 text-white px-6 py-4 rounded-lg font-medium focus-ring">
            <i class="bi bi-shield-exclamation mr-2"></i>
            <div>Fake News Detection</div>
            <div class="text-sm opacity-80">Detect if news is fake or real</div>
        </button>
        <button id="politicalBtn" class="analysis-type-btn bg-gray-200 text-gray-700 px-6 py-4 rounded-lg font-medium focus-ring">
            <i class="bi bi-bank mr-2"></i>
            <div>Political Classification</div>
            <div class="text-sm opacity-80">Classify as political or non-political</div>
        </button>
        <button id="bothBtn" class="analysis-type-btn bg-gray-200 text-gray-700 px-6 py-4 rounded-lg font-medium focus-ring">
            <i class="bi bi-layers mr-2"></i>
            <div>Both Analyses</div>
            <div class="text-sm opacity-80">Run both fake news and political analysis</div>
        </button>
    </div>
</div>

<!-- Text Input Section -->
<div id="textInput" class="input-section">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">
        <i class="bi bi-pencil-square"></i>
        Enter News Text
    </h3>
    <div class="tooltip">
        <textarea 
            id="newsText" 
            placeholder="Paste the news article text here... (Tip: Use Ctrl+Enter to analyze quickly)"
            class="w-full h-48 p-4 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent custom-scrollbar"
            aria-label="News article text input"
        ></textarea>
        <span class="tooltip-text">Enter at least 10 characters for analysis</span>
    </div>
    <div class="flex justify-between items-center mt-2">
        <span class="text-xs text-gray-400">
            <i class="bi bi-info-circle mr-1"></i>
            Press Ctrl+Enter to analyze quickly
        </span>
        <span id="textCount" class="text-sm text-gray-500">0 characters</span>
    </div>
</div>

<!-- URL Input Section -->
<div id="urlInput" class="input-section hidden">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">
        <i class="bi bi-globe"></i>
        Enter Article URL
    </h3>
    <div class="relative">
        <input 
            type="url" 
            id="articleUrl" 
            placeholder="https://example.com/news-article"
            class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            aria-label="Article URL input"
        />
        <i class="bi bi-link absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
    </div>
    <p class="text-sm text-gray-600 mt-2">
        <i class="bi bi-info-circle mr-1"></i>
        Enter a news article URL to extract and analyze its content
    </p>
</div>

<!-- Website Crawling Input Section -->
<div id="websiteInput" class="input-section hidden">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">
        <i class="bi bi-globe2"></i>
        Enter News Website URL
    </h3>
    <div class="relative mb-4">
        <input 
            type="url" 
            id="websiteUrl" 
            placeholder="https://example-news-site.com"
            class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            aria-label="News website URL input"
        />
        <i class="bi bi-globe2 absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
    </div>
    
    <!-- Website Crawling Options -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
            <label for="maxArticles" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="bi bi-list-ol mr-1"></i>
                Max Articles to Analyze
            </label>
            <select id="maxArticles" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="5">5 articles</option>
                <option value="10" selected>10 articles</option>
                <option value="15">15 articles</option>
                <option value="20">20 articles</option>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="bi bi-gear mr-1"></i>
                Website Action
            </label>
            <div class="flex flex-wrap gap-2">
                <button id="crawlOnlyBtn" class="crawl-mode-btn bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-medium focus-ring">
                    <i class="bi bi-search mr-1"></i>
                    Preview
                </button>
                <button id="crawlAnalyzeBtn" class="crawl-mode-btn bg-gray-200 text-gray-700 px-3 py-2 rounded-lg text-sm font-medium focus-ring">
                    <i class="bi bi-cpu mr-1"></i>
                    Analyze & Index
                </button>
            </div>
        </div>
    </div>
    
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <div class="flex items-start">
            <i class="bi bi-info-circle text-blue-600 text-lg mr-2 mt-0.5"></i>
            <div class="text-sm text-blue-800">
                <p class="font-medium mb-1">Website Analysis Options:</p>
                <ul class="space-y-1 text-blue-700">
                    <li>• <strong>Preview:</strong> Find and display article links without analysis</li>
                    <li>• <strong>Analyze & Index:</strong> Analyze articles for fake news/political content AND automatically add Philippine news to the searchable database</li>
                    <li>• Works best with major news websites (ABS-CBN, GMA, Inquirer, Rappler, etc.)</li>
                    <li>• Individual article URLs are also automatically indexed when analyzed</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Analyze Button -->
<div id="analyzeButtonSection" class="mt-8 text-center">
    <button 
        id="analyzeBtn"
        disabled
        class="bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-4 px-8 rounded-lg shadow-lg hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200"
        aria-label="Analyze news content"
    >
        <i class="bi bi-search mr-2"></i>
        Analyze News
    </button>
</div>

<!-- Loading Indicator -->
<div id="loading" class="hidden mt-8 text-center">
    <div class="inline-flex items-center">
        <i class="bi bi-hourglass-split spin text-blue-600 text-2xl mr-3"></i>
        <span class="text-gray-700 text-lg">Analyzing content...</span>
    </div>
</div>

<!-- Results Section -->
<div id="results" class="hidden mt-8">
    <h3 class="text-2xl font-semibold text-gray-800 mb-6">
        <i class="bi bi-clipboard-data"></i>
        Analysis Results
    </h3>
    
    <!-- Fake News Results -->
    <div id="fakeNewsResults" class="hidden mb-8">
        <h4 class="text-xl font-semibold text-gray-800 mb-4">
            <i class="bi bi-shield-check"></i>
            Fake News Detection
        </h4>
        
        <!-- Fake News Prediction Card -->
        <div id="fakeNewsPredictionCard" class="prediction-card result-card rounded-xl p-6 mb-6 border-l-4">
            <div class="flex items-center justify-between">
                <div>
                    <h5 class="text-lg font-semibold mb-2">Prediction</h5>
                    <p id="fakeNewsPredictionText" class="text-2xl font-bold"></p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600 mb-1">Confidence</p>
                    <p id="fakeNewsConfidenceText" class="text-xl font-semibold"></p>
                </div>
            </div>
        </div>

        <!-- Fake News Probability Bars -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="bg-white rounded-lg p-4 shadow-md result-card">
                <div class="flex items-center justify-between mb-2">
                    <span class="font-medium text-red-700">
                        <i class="bi bi-exclamation-triangle"></i>
                        Fake
                    </span>
                    <span id="fakePercentage" class="font-semibold text-red-700"></span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="fakeBar" class="progress-bar fake h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg p-4 shadow-md result-card">
                <div class="flex items-center justify-between mb-2">
                    <span class="font-medium text-green-700">
                        <i class="bi bi-check-circle"></i>
                        Real
                    </span>
                    <span id="realPercentage" class="font-semibold text-green-700"></span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="realBar" class="progress-bar real h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Political Classification Results -->
    <div id="politicalResults" class="hidden mb-8">
        <h4 class="text-xl font-semibold text-gray-800 mb-4">
            <i class="bi bi-bank"></i>
            Political Classification
        </h4>
        
        <!-- Political Prediction Card -->
        <div id="politicalPredictionCard" class="prediction-card result-card rounded-xl p-6 mb-6 border-l-4">
            <div class="flex items-center justify-between">
                <div>
                    <h5 class="text-lg font-semibold mb-2">Classification</h5>
                    <p id="politicalPredictionText" class="text-2xl font-bold"></p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600 mb-1">Confidence</p>
                    <p id="politicalConfidenceText" class="text-xl font-semibold"></p>
                </div>
            </div>
        </div>

        <!-- Political Probability Bars -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="bg-white rounded-lg p-4 shadow-md result-card">
                <div class="flex items-center justify-between mb-2">
                    <span class="font-medium text-blue-700">
                        <i class="bi bi-bank"></i>
                        Political
                    </span>
                    <span id="politicalPercentage" class="font-semibold text-blue-700"></span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="politicalBar" class="progress-bar political h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg p-4 shadow-md result-card">
                <div class="flex items-center justify-between mb-2">
                    <span class="font-medium text-gray-700">
                        <i class="bi bi-newspaper"></i>
                        Non-Political
                    </span>
                    <span id="nonPoliticalPercentage" class="font-semibold text-gray-700"></span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="nonPoliticalBar" class="progress-bar non-political h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Political Reasoning -->
        <div id="politicalReasoning" class="bg-gray-50 rounded-lg p-6 mb-6 result-card">
            <h5 class="text-lg font-semibold text-gray-800 mb-3">
                <i class="bi bi-lightbulb"></i>
                Analysis Reasoning
            </h5>
            <div id="reasoningText" class="text-gray-700 whitespace-pre-line custom-scrollbar"></div>
        </div>
    </div>

    <!-- Extracted Content (for URL input) -->
    <div id="extractedContent" class="hidden bg-gray-50 rounded-lg p-6 result-card">
        <h4 class="text-lg font-semibold text-gray-800 mb-3">
            <i class="bi bi-file-text"></i>
            Extracted Content
        </h4>
        <div class="space-y-3">
            <div>
                <p class="text-sm font-medium text-gray-600">Title:</p>
                <p id="extractedTitle" class="text-gray-800 font-medium"></p>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">Content Preview:</p>
                <p id="extractedPreview" class="text-gray-700 text-sm custom-scrollbar max-h-32 overflow-y-auto"></p>
            </div>
        </div>
    </div>
</div>

<!-- Website Crawling Results -->
<div id="websiteResults" class="hidden mt-8">
    <h3 class="text-2xl font-semibold text-gray-800 mb-6">
        <i class="bi bi-list-check"></i>
        Website Analysis Results
    </h3>
    
    <!-- Crawling Summary -->
    <div id="crawlingSummary" class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 mb-6 border border-blue-200">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="text-center">
                <div class="text-3xl font-bold text-blue-600" id="totalArticlesCount">0</div>
                <div class="text-sm text-gray-600">Articles Found</div>
            </div>
            <div class="text-center">
                <div class="text-3xl font-bold text-green-600" id="successfulAnalysesCount">0</div>
                <div class="text-sm text-gray-600">Successfully Analyzed</div>
            </div>
            <div class="text-center">
                <div class="text-3xl font-bold text-red-600" id="failedAnalysesCount">0</div>
                <div class="text-sm text-gray-600">Failed</div>
            </div>
        </div>
        
        <!-- Website Title -->
        <div class="mt-4 text-center">
            <h4 class="text-lg font-semibold text-gray-800" id="analyzedWebsiteTitle">Website Analysis</h4>
        </div>
        
        <!-- Overall Statistics -->
        <div id="overallStats" class="hidden mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Fake News Stats -->
            <div id="fakeNewsStats" class="bg-white rounded-lg p-4 shadow-sm">
                <h5 class="font-semibold text-gray-800 mb-3 flex items-center">
                    <i class="bi bi-shield-exclamation text-red-600 mr-2"></i>
                    Fake News Distribution
                </h5>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-red-700">Fake Articles:</span>
                        <span id="fakeArticlesCount" class="font-semibold">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-green-700">Real Articles:</span>
                        <span id="realArticlesCount" class="font-semibold">0</span>
                    </div>
                    <div class="mt-2 pt-2 border-t">
                        <div class="flex justify-between">
                            <span class="text-gray-700">Fake Percentage:</span>
                            <span id="fakePercentageOverall" class="font-semibold text-red-600">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Political Stats -->
            <div id="politicalStats" class="bg-white rounded-lg p-4 shadow-sm">
                <h5 class="font-semibold text-gray-800 mb-3 flex items-center">
                    <i class="bi bi-bank text-blue-600 mr-2"></i>
                    Political Distribution
                </h5>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-blue-700">Political Articles:</span>
                        <span id="politicalArticlesCount" class="font-semibold">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-700">Non-Political:</span>
                        <span id="nonPoliticalArticlesCount" class="font-semibold">0</span>
                    </div>
                    <div class="mt-2 pt-2 border-t">
                        <div class="flex justify-between">
                            <span class="text-gray-700">Political Percentage:</span>
                            <span id="politicalPercentageOverall" class="font-semibold text-blue-600">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Individual Article Results -->
    <div id="articleResultsList" class="space-y-4">
        <!-- Article results will be dynamically inserted here -->
    </div>
    
    <!-- Crawled Articles List (for preview mode) -->
    <div id="crawledArticlesList" class="hidden space-y-3">
        <h4 class="text-lg font-semibold text-gray-800 mb-4">
            <i class="bi bi-list-ul"></i>
            Found Articles
        </h4>
        <div id="articleLinksContainer">
            <!-- Article links will be dynamically inserted here -->
        </div>
        <div class="mt-4 text-center">
            <button id="analyzeFoundArticlesBtn" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                <i class="bi bi-cpu mr-2"></i>
                Analyze These Articles
            </button>
        </div>
    </div>
</div>

<!-- Error Display -->
<div id="error" class="hidden mt-8 bg-red-50 border border-red-200 rounded-lg p-4">
    <div class="flex items-center">
        <i class="bi bi-exclamation-circle text-red-500 text-xl mr-3"></i>
        <div class="flex-1">
            <h4 class="text-red-800 font-semibold">Error</h4>
            <p id="errorMessage" class="text-red-700"></p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/news-analysis.js') }}"></script>
{% endblock %}
